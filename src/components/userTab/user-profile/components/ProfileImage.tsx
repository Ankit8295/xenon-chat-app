/* eslint-disable react-hooks/exhaustive-deps */
/* eslint-disable @next/next/no-img-element */
import defaultUserImage from "@/public/userProfile.webp";
import { useEffect, useState } from "react";
import useQueryFunction from "@/src/lib/useQueries";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import Image from "next/image";

export default function ProfileImage({ imageUrl }: { imageUrl: string }) {
  const queryClient = useQueryClient();
  const [profileImg, setProfileImg] = useState<File | null>(null);
  const { updateUserProfilePic } = useQueryFunction();

  const { mutate } = useMutation(updateUserProfilePic, {
    onSuccess: () => {
      queryClient.invalidateQueries(["userDetails"]);
    },
  });
  useEffect(() => {
    if (profileImg) {
      const imageData = new FormData();
      imageData.set("image", profileImg);
      mutate({ data: imageData, prevImageName: imageUrl.split(".com/")[1] });
    }
  }, [profileImg]);

  return (
    <div className="relative overflow-hidden">
      <Image
        src={
          profileImg
            ? URL.createObjectURL(profileImg)
            : imageUrl || defaultUserImage
        }
        alt="user_profile_img"
        width={250}
        height={250}
        priority={true}
        placeholder="blur"
        blurDataURL="data:image/jpeg;base64,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"
        style={{ borderRadius: "50%", objectFit: "cover" }}
        className="max-w-[250px] max-h-[250px] min-w-[250px] min-h-[250px] object-cover rounded-[50%]"
      />
      <label className="group absolute top-0 left-0 flex justify-center items-center w-full h-full hover:bg-black/50 rounded-[50%] hover:cursor-pointer transition-colors">
        <input
          type="file"
          className="hidden"
          accept="image/*"
          onChange={(e: any) => setProfileImg(e.target.files[0])}
        />
        <span className="hidden group-hover:block">Upload/Change Profile</span>
      </label>
    </div>
  );
}
